name: Deploy Flask App

on:
  push:
    branches:
      - master  # Trigger on push to main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.13'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Copy files to server (using SCP)
      run: |
        scp -r ./ ec2-user@<YOUR_SERVER_IP>:/home/ec2-user/crime-dashboard
      env:
        SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}

    - name: Restart Flask app (via SSH)
      run: |
        ssh ec2-user@<YOUR_SERVER_IP> << 'EOF'
          cd /home/ec2-user/crime-dashboard
          docker-compose down
          docker-compose up -d --build
        EOF
